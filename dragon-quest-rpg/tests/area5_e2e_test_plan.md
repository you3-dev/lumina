# エリア5 E2Eテスト計画書

**テスト対象URL**: https://you3-dev.github.io/lumina/dragon-quest-rpg/  
**テスト実施日**: 2026-01-18  
**テスト目的**: エリア5の実装が設計書通りに動作するか検証し、修正が必要な箇所を特定する

---

## テスト環境準備

### 1. エリア4クリア状態のセーブデータ作成
```javascript
// コンソールで実行するスクリプト
const area4ClearedSave = {
    player: {
        name: "勇者",
        level: 45,
        hp: 280,
        maxHp: 280,
        mp: 150,
        maxMp: 150,
        exp: 50000,
        atk: 120,
        def: 90,
        x: 15,
        y: 10,
        direction: "down",
        inventory: [
            { id: 1, quantity: 10 },  // 薬草
            { id: 2, quantity: 5 },   // 毒消し草
            { id: 100, quantity: 1 }  // 極光の宝珠（エリア4報酬）
        ]
    },
    party: [
        {
            name: "勇者",
            class: "hero",
            level: 45,
            hp: 280,
            maxHp: 280,
            mp: 150,
            maxMp: 150,
            exp: 50000,
            atk: 120,
            def: 90,
            spells: ["hoimi", "rura", "dein"]
        }
    ],
    partyData: {
        gold: 50000,
        moving: false,
        vehicle: "none",
        oxygen: 100,
        totalSteps: 0
    },
    gameProgress: {
        bossDefeated: {
            midBoss: true,
            quicksandBoss: true,
            banditKing: true,
            pyramidGuardian: true,
            desertGuardian: true,
            shadowGuardian: true,
            wedgeGuardian_north: true,
            wedgeGuardian_east: true,
            wedgeGuardian_south: true,
            wedgeGuardian_west: true,
            libraryGuardian: true,
            iceGolem: true,
            iceQueen: true,
            siren: false,
            kraken: false,
            leviathan: false,
            albida: false
        },
        storyFlags: {
            area4Completed: true,
            iceQueenDefeated: true,
            auroraOrbObtained: true,
            tearOfBlueObtained: false,
            tearOfRedObtained: false,
            tearOfGreenObtained: false,
            allTearsObtained: false,
            area5Completed: false
        }
    },
    currentMapId: "snow_village",
    currentMapPath: "maps/snow_village.json"
};

localStorage.setItem('dragonQuestSave', JSON.stringify(area4ClearedSave));
location.reload();
```

---

## テストケース一覧

### Phase 1: エリア4→エリア5への遷移テスト

#### TC-A5-001: 雪の長老イベント確認
**前提条件**: エリア4クリア状態  
**テスト手順**:
1. 雪の村で長老NPCに話しかける
2. 台詞内容を確認
3. ポルティアへの導線が示されるか確認

**期待結果**:
- 「氷の女王を倒したか！」から始まる台詞
- 「港町ポルティア」への言及
- `area4Completed` フラグが `true` になる

**確認項目**:
- [ ] 台詞が設計書通りか
- [ ] フラグが正しく設定されるか
- [ ] 次の目的地が明確か

---

#### TC-A5-002: 城の時空の間からポルティアへのワープ
**前提条件**: TC-A5-001完了  
**テスト手順**:
1. グランディア城の「時空の間」へ移動
2. ポルティアへのポータルが出現しているか確認
3. ポータルに入る

**期待結果**:
- ポルティアのマップに遷移
- プレイヤーが正しい座標にスポーン

**確認項目**:
- [ ] ポータルが表示されるか
- [ ] ワープが機能するか
- [ ] スポーン位置が適切か

---

### Phase 2: 港町ポルティアのテスト

#### TC-A5-003: ポルティアの施設確認
**前提条件**: ポルティアに到着  
**テスト手順**:
1. マップ内の各施設を確認
   - 教会
   - 宿屋
   - 武器屋
   - 道具屋
   - 造船所
   - 市長の家
2. 各NPCに話しかける

**期待結果**:
- 全施設が配置されている
- NPCが適切な台詞を話す
- 施設が機能する（店・宿・教会）

**確認項目**:
- [ ] 教会が機能するか
- [ ] 宿屋が機能するか（100G）
- [ ] 武器屋の品揃えが適切か
- [ ] 道具屋に酸素缶があるか
- [ ] NPCの台詞が設計書通りか

---

#### TC-A5-004: 市長から船の入手
**前提条件**: TC-A5-003完了  
**テスト手順**:
1. 市長の家に入る
2. 市長に話しかける
3. 「船の呼び笛」を入手

**期待結果**:
- 市長の台詞が表示される
- アイテムID 121「船の呼び笛」を入手
- ファンファーレが鳴る

**確認項目**:
- [ ] アイテムが正しく付与されるか
- [ ] 台詞が設計書通りか
- [ ] SEが鳴るか

---

#### TC-A5-005: 隠しアイテムの確認
**前提条件**: ポルティアに到着  
**テスト手順**:
1. 樽（28, 20）を調べる → 100ゴールド
2. 武器屋裏（24, 7）を調べる → 守りの種

**期待結果**:
- 各アイテムが入手できる
- チェストが開封済みになる

**確認項目**:
- [ ] 100ゴールドが正しく加算されるか
- [ ] 守りの種が入手できるか
- [ ] 再度調べても取得できないか

---

### Phase 3: 外海への出航とアルビダ戦

#### TC-A5-006: 船の出航
**前提条件**: 船の呼び笛を所持  
**テスト手順**:
1. 北の桟橋（15, 0）に移動
2. Aボタンで調べる
3. 外海マップに遷移

**期待結果**:
- 「船を出した！」メッセージ
- `vehicle` が `'ship'` になる
- 外海マップ（area5_ocean）に遷移

**確認項目**:
- [ ] ワープが機能するか
- [ ] 船状態になるか
- [ ] 座標が正しいか（100, 106付近）

---

#### TC-A5-007: アルビダ戦の発生（初回のみ）
**前提条件**: TC-A5-006完了、`albida` 未撃破  
**テスト手順**:
1. ポルティアから出航
2. イベント台詞を確認
3. アルビダとの戦闘が開始されるか確認

**期待結果**:
- 「前方に海賊船が現れた！」メッセージ
- アルビダの台詞
- 戦闘画面に遷移
- アルビダ（Lv50, HP2500）が出現

**確認項目**:
- [ ] イベントが初回のみ発生するか
- [ ] 台詞が設計書通りか
- [ ] 戦闘が開始されるか
- [ ] 2回目以降は発生しないか

---

#### TC-A5-008: アルビダ戦の勝利
**前提条件**: TC-A5-007で戦闘開始  
**テスト手順**:
1. アルビダを撃破
2. 経験値・ゴールドを確認
3. `bossDefeated.albida` フラグを確認

**期待結果**:
- 経験値 2000、ゴールド 1000 を獲得
- フラグが `true` になる
- 戦闘終了後、外海に戻る

**確認項目**:
- [ ] 報酬が正しいか
- [ ] フラグが設定されるか
- [ ] 戦闘後の状態が正常か

---

### Phase 4: 外海の探索

#### TC-A5-009: 外海マップの確認
**前提条件**: 外海に到着  
**テスト手順**:
1. マップがループするか確認（200x200）
2. 各島の位置を確認
   - ポルティア（中央）
   - 珊瑚の村（北西）
   - 監獄島（南東）
   - ギガント（西）
   - 海神の祭壇（ポルティア北）
3. 潮流タイルの動作確認

**期待結果**:
- マップが正しくループする
- 各島が配置されている
- 潮流タイルで自動移動する

**確認項目**:
- [ ] ループ機能が動作するか
- [ ] 島の配置が正しいか
- [ ] 潮流タイルが機能するか

---

#### TC-A5-010: 船の乗り降り
**前提条件**: 外海を航行中  
**テスト手順**:
1. 島の港タイル（TILE.PORT）に接近
2. Aボタンで上陸
3. 再度海に出る

**期待結果**:
- 港で正しく上陸できる
- `vehicle` が `'none'` になる
- 再乗船時に `'ship'` に戻る

**確認項目**:
- [ ] 上陸が機能するか
- [ ] 再乗船が機能するか
- [ ] 状態が正しく切り替わるか

---

### Phase 5: 珊瑚の村と珊瑚の迷宮

#### TC-A5-011: 珊瑚の村への上陸
**前提条件**: 外海を航行中  
**テスト手順**:
1. 座標（45, 33）の港に接近
2. 上陸して珊瑚の村に入る
3. NPCに話しかける

**期待結果**:
- 珊瑚の村マップに遷移
- NPCが迷宮のヒントを話す

**確認項目**:
- [ ] ワープが機能するか
- [ ] NPCの台詞が適切か
- [ ] 迷宮への入口があるか

---

#### TC-A5-012: 珊瑚の迷宮の音パズル
**前提条件**: 珊瑚の迷宮に入る  
**テスト手順**:
1. 迷宮内を移動
2. セイレーン（10, 5）に近づく・遠ざかる
3. 音（SE）が変化するか確認

**期待結果**:
- 近づくと高い音（confirm）
- 遠ざかると低い音（cancel）
- 音を頼りにゴールに到達できる

**確認項目**:
- [ ] 距離判定が正しいか
- [ ] SEが鳴るか
- [ ] パズルとして機能するか

---

#### TC-A5-013: セイレーン戦
**前提条件**: 珊瑚の迷宮でセイレーンに接触  
**テスト手順**:
1. セイレーンに話しかける
2. 戦闘開始
3. 撃破

**期待結果**:
- セイレーン（Lv40, HP400）との戦闘
- スキル「rariho」「hyado」を使用
- 撃破後、「青の涙」（ID 122）を入手
- `tearOfBlueObtained` が `true` になる

**確認項目**:
- [ ] 戦闘が開始されるか
- [ ] スキルが使用されるか
- [ ] アイテムが入手できるか
- [ ] フラグが設定されるか

---

### Phase 6: 監獄島

#### TC-A5-014: 監獄島への上陸
**前提条件**: 外海を航行中  
**テスト手順**:
1. 座標（160, 170）の港に接近
2. 上陸して監獄島に入る

**期待結果**:
- 監獄島マップに遷移
- `sealSpells: true` で呪文が使えない

**確認項目**:
- [ ] ワープが機能するか
- [ ] 呪文封印が機能するか

---

#### TC-A5-015: 巡回ガードとの接触
**前提条件**: 監獄島内  
**テスト手順**:
1. ガードNPC（type: 'guard'）に接触
2. 戦闘が開始されるか確認

**期待結果**:
- 接触時に自動で戦闘開始
- `prison_guard` との戦闘

**確認項目**:
- [ ] 接触判定が機能するか
- [ ] 戦闘が開始されるか
- [ ] 逃走不可か

---

#### TC-A5-016: クラーケン戦
**前提条件**: 監獄島の最深部  
**テスト手順**:
1. クラーケンに話しかける
2. 戦闘開始
3. 撃破

**期待結果**:
- クラーケン（Lv50, HP1200）との戦闘
- 2回行動する
- 撃破後、「赤の涙」（ID 123）を入手
- `tearOfRedObtained` が `true` になる

**確認項目**:
- [ ] 2回行動が機能するか
- [ ] アイテムが入手できるか
- [ ] フラグが設定されるか

---

### Phase 7: 巨獣ギガント

#### TC-A5-017: ギガントの出現
**前提条件**: 外海を航行中  
**テスト手順**:
1. 座標（14, 103）付近に移動
2. ギガント島が表示されているか確認
3. 上陸

**期待結果**:
- ギガント島が表示される
- 上陸できる

**確認項目**:
- [ ] 島が表示されるか
- [ ] 上陸が機能するか

---

#### TC-A5-018: ギガント体内の酸タイル
**前提条件**: ギガント体内に入る  
**テスト手順**:
1. 酸タイル（TILE.ACID = 37）を踏む
2. ダメージを受けるか確認

**期待結果**:
- 15ダメージを受ける
- ダメージSEが鳴る
- HP 1以下にはならない

**確認項目**:
- [ ] ダメージが発生するか
- [ ] SEが鳴るか
- [ ] 即死しないか

---

#### TC-A5-019: 緑の涙の入手
**前提条件**: ギガント体内  
**テスト手順**:
1. チェスト（22, 2）を調べる
2. 「緑の涙」を入手

**期待結果**:
- 「緑の涙」（ID 124）を入手
- `tearOfGreenObtained` が `true` になる

**確認項目**:
- [ ] アイテムが入手できるか
- [ ] フラグが設定されるか

---

### Phase 8: 海神の祭壇

#### TC-A5-020: 海神の祭壇への上陸
**前提条件**: 3つの涙を所持  
**テスト手順**:
1. 座標（100, 82）の港に接近
2. 上陸して祭壇マップに入る

**期待結果**:
- 祭壇マップに遷移
- 祭壇オブジェクト（💎）が表示される

**確認項目**:
- [ ] ワープが機能するか
- [ ] 祭壇が表示されるか

---

#### TC-A5-021: 涙の奉納イベント（3つ揃っていない場合）
**前提条件**: 涙が3つ未満  
**テスト手順**:
1. 祭壇に話しかける

**期待結果**:
- 「3つの大粒の涙を揃えて捧げねばならぬ...」メッセージ
- イベントが進行しない

**確認項目**:
- [ ] 条件チェックが機能するか
- [ ] 適切なメッセージが表示されるか

---

#### TC-A5-022: 涙の奉納イベント（3つ揃った場合）
**前提条件**: 3つの涙を所持  
**テスト手順**:
1. 祭壇に話しかける
2. イベントメッセージを確認

**期待結果**:
- 「3つの涙を祭壇に捧げた！」
- 「不思議な光が天に向かって立ち昇る……！」
- 「遥か彼方の海で、巨大な渦を覆っていた結界が消滅した！」
- `allTearsObtained` が `true` になる
- ファンファーレが鳴る

**確認項目**:
- [ ] イベントが発生するか
- [ ] フラグが設定されるか
- [ ] SEが鳴るか

---

### Phase 9: アトランティア

#### TC-A5-023: アトランティアへの進入（結界あり）
**前提条件**: `allTearsObtained` が `false`  
**テスト手順**:
1. 座標（100, 100）の渦に接近
2. 進入を試みる

**期待結果**:
- 「渦の中へ入ろうとしたが、強力な結界に弾き返された！」
- 「３つの「海神の涙」が必要なようだ……。」
- 進入できない

**確認項目**:
- [ ] 結界メッセージが表示されるか
- [ ] 進入が阻止されるか

---

#### TC-A5-024: アトランティアへの進入（結界なし）
**前提条件**: `allTearsObtained` が `true`  
**テスト手順**:
1. 座標（100, 100）の渦に接近
2. 進入

**期待結果**:
- アトランティアマップに遷移
- 水中エフェクトが表示される
- 酸素ゲージが減少する

**確認項目**:
- [ ] ワープが機能するか
- [ ] 水中エフェクトが表示されるか
- [ ] 酸素システムが機能するか

---

#### TC-A5-025: 酸素ゲージの確認
**前提条件**: アトランティア内  
**テスト手順**:
1. 移動して酸素を消費
2. 泡タイル（TILE.BUBBLE）で回復

**期待結果**:
- 移動ごとに酸素が減少
- 酸素0でダメージ（最大HPの10%）
- 泡タイルで酸素100に回復

**確認項目**:
- [ ] 酸素減少が機能するか
- [ ] ダメージが発生するか
- [ ] 回復が機能するか

---

#### TC-A5-026: リヴァイアサン戦
**前提条件**: アトランティア最深部  
**テスト手順**:
1. リヴァイアサンに話しかける
2. 戦闘開始
3. 撃破

**期待結果**:
- リヴァイアサン（Lv60, HP3000）との戦闘
- 2回行動する
- HP 30%以下でベホマを使用
- 撃破後、「天空の海図」（ID 125）を入手
- 「海神リヴァイアサンを倒した！」
- 「光の中から「天空の海図」が現れた！」
- 「この海図は、天空界への道を示しているようだ……。」
- `area5Completed` が `true` になる

**確認項目**:
- [ ] 2回行動が機能するか
- [ ] HP依存AIが機能するか
- [ ] アイテムが入手できるか
- [ ] メッセージが設計書通りか
- [ ] フラグが設定されるか

---

### Phase 10: 回帰テスト

#### TC-A5-027: セーブ・ロード機能
**前提条件**: 任意の地点  
**テスト手順**:
1. セーブ
2. リロード
3. ロード

**期待結果**:
- 全ての状態が保存される
  - プレイヤー座標
  - 船の状態
  - 酸素値
  - 歩数
  - フラグ
  - アイテム

**確認項目**:
- [ ] セーブが機能するか
- [ ] ロードが機能するか
- [ ] 全データが復元されるか

---

#### TC-A5-028: 既存エリアへの影響確認
**前提条件**: エリア5実装後  
**テスト手順**:
1. エリア1-4の主要機能を確認
   - 移動
   - 戦闘
   - NPC会話
   - アイテム使用

**期待結果**:
- 既存エリアに影響なし
- デグレが発生していない

**確認項目**:
- [ ] エリア1が正常か
- [ ] エリア2が正常か
- [ ] エリア3が正常か
- [ ] エリア4が正常か

---

## 追加テストケース

### パフォーマンステスト

#### TC-A5-P01: 外海マップのパフォーマンス
**テスト手順**:
1. 外海マップ（200x200）を高速移動
2. FPSを確認

**期待結果**:
- 30FPS以上を維持
- カクつきがない

---

#### TC-A5-P02: 戦闘のパフォーマンス
**テスト手順**:
1. 複数回戦闘を実行
2. メモリリークがないか確認

**期待結果**:
- メモリ使用量が安定
- 戦闘終了後にメモリが解放される

---

### エッジケーステスト

#### TC-A5-E01: 船に乗ったまま陸地に侵入
**テスト手順**:
1. 船で陸地タイルに進入を試みる

**期待結果**:
- 進入できない
- エラーが発生しない

---

#### TC-A5-E02: 酸素0の状態で戦闘
**テスト手順**:
1. 酸素を0にする
2. 戦闘を開始

**期待結果**:
- 戦闘中は酸素ダメージが発生しない
- 戦闘後に再開される

---

#### TC-A5-E03: ボス撃破後の再接触
**テスト手順**:
1. ボスを撃破
2. 同じNPCに再度話しかける

**期待結果**:
- 戦闘が再発生しない
- 適切なメッセージが表示される

---

## テスト実施スケジュール

1. **Phase 1-2**: エリア遷移とポルティア（30分）
2. **Phase 3-4**: 出航と外海探索（30分）
3. **Phase 5-7**: 各ダンジョンとボス（60分）
4. **Phase 8-9**: 祭壇とアトランティア（30分）
5. **Phase 10**: 回帰テスト（30分）
6. **追加テスト**: パフォーマンスとエッジケース（30分）

**合計予定時間**: 約3.5時間

---

## 不具合記録フォーマット

各テストケースで問題が見つかった場合、以下の形式で記録します：

```markdown
### [TC-A5-XXX] テストケース名

**不具合内容**:
- 期待結果と実際の結果の差異

**再現手順**:
1. 
2. 
3. 

**スクリーンショット**:
[添付]

**優先度**: High / Medium / Low

**推定原因**:
- 

**修正案**:
- 
```

---

## テスト完了後の成果物

1. **テスト実施レポート**
   - 各テストケースの結果（Pass/Fail）
   - 不具合一覧
   - スクリーンショット集

2. **不具合修正計画書**
   - 優先度順の修正リスト
   - 修正の影響範囲
   - 修正スケジュール

3. **録画動画**
   - 各フェーズのブラウザ操作録画（WebP形式）

---

## 備考

- テストは自動化されたブラウザ操作で実施
- すべての操作は動画として記録される
- 不具合が見つかっても即座に修正せず、まず記録する
- テスト完了後に修正計画を立案する
